<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pr√©stamos - Ejemplo Insecure Design</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .vulnerable-section {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .secure-section {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .code-block {
            background: #263238;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .form-group {
            margin: 15px 0;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .danger-btn {
            background: #dc3545;
        }
        
        .danger-btn:hover {
            background: #c82333;
        }
        
        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .threat-analysis {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            cursor: pointer;
            margin-right: 2px;
        }
        
        .tab.active {
            background: #007bff;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .vulnerability-list {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 10px 0;
        }
        
        .vulnerability-item {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #f44336;
            background: #ffebee;
        }
        
        .mitigation-item {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #4caf50;
            background: #e8f5e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Sistema de Pr√©stamos Online</h1>
            <h2>Ejemplo Pr√°ctico: A04 - Insecure Design</h2>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('scenario')">Escenario</div>
            <div class="tab" onclick="showTab('vulnerable')">Dise√±o Vulnerable</div>
            <div class="tab" onclick="showTab('secure')">Dise√±o Seguro</div>
            <div class="tab" onclick="showTab('analysis')">An√°lisis de Amenazas</div>
        </div>
        
        <div id="scenario" class="tab-content active">
            <h3>üìã Escenario del Sistema</h3>
            <p><strong>Contexto:</strong> Una fintech desarrolla un sistema de pr√©stamos online que permite a los usuarios solicitar pr√©stamos personales de hasta $50,000 USD.</p>
            
            <h4>Requerimientos del Negocio:</h4>
            <ul>
                <li>Proceso de solicitud r√°pido (menos de 10 minutos)</li>
                <li>Aprobaci√≥n autom√°tica para montos menores a $5,000</li>
                <li>Verificaci√≥n de identidad b√°sica</li>
                <li>Evaluaci√≥n crediticia simplificada</li>
            </ul>
            
            <h4>Actores del Sistema:</h4>
            <ul>
                <li><strong>Solicitante:</strong> Usuario que solicita el pr√©stamo</li>
                <li><strong>Sistema de Evaluaci√≥n:</strong> Algoritmo que aprueba/rechaza</li>
                <li><strong>Operador:</strong> Personal que revisa casos especiales</li>
                <li><strong>Administrador:</strong> Gestiona configuraciones del sistema</li>
            </ul>
        </div>
        
        <div id="vulnerable" class="tab-content">
            <h3>üö® Dise√±o Vulnerable</h3>
            
            <div class="vulnerable-section">
                <h4>Formulario de Solicitud (Dise√±o Inseguro)</h4>
                <div class="form-section">
                    <div class="form-group">
                        <label>Nombre Completo:</label>
                        <input type="text" id="fullName" placeholder="Juan P√©rez">
                    </div>
                    <div class="form-group">
                        <label>Monto Solicitado:</label>
                        <input type="number" id="amount" placeholder="5000" max="50000">
                    </div>
                    <div class="form-group">
                        <label>Ingresos Mensuales:</label>
                        <input type="number" id="income" placeholder="3000">
                    </div>
                    <div class="form-group">
                        <label>¬øCu√°l es el nombre de tu primera mascota?</label>
                        <input type="text" id="petName" placeholder="Para recuperaci√≥n de cuenta">
                    </div>
                    <div class="form-group">
                        <label>¬øEn qu√© ciudad naciste?</label>
                        <input type="text" id="birthCity" placeholder="Para verificaci√≥n de identidad">
                    </div>
                    <button onclick="submitVulnerableForm()">Solicitar Pr√©stamo</button>
                </div>
            </div>
            
            <div class="vulnerability-list">
                <h4>üîç Vulnerabilidades Identificadas:</h4>
                <div class="vulnerability-item">
                    <strong>1. Preguntas de Seguridad Predecibles:</strong>
                    <p>Usar preguntas como "nombre de mascota" o "ciudad natal" viola las recomendaciones de NIST 800-63b.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>2. Validaci√≥n Solo en Frontend:</strong>
                    <p>Los l√≠mites de monto solo se validan en el cliente, permitiendo manipulaci√≥n.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>3. Falta de Verificaci√≥n de Identidad:</strong>
                    <p>No hay verificaci√≥n real de la identidad del solicitante.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>4. Ausencia de Controles de Frecuencia:</strong>
                    <p>No hay l√≠mites en el n√∫mero de solicitudes por usuario/IP.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>5. L√≥gica de Negocio D√©bil:</strong>
                    <p>Aprobaci√≥n autom√°tica sin verificaciones cruzadas adecuadas.</p>
                </div>
            </div>
        </div>
        
        <div id="secure" class="tab-content">
            <h3>‚úÖ Dise√±o Seguro</h3>
            
            <div class="secure-section">
                <h4>Formulario de Solicitud (Dise√±o Seguro)</h4>
                <div class="form-section">
                    <div class="form-group">
                        <label>Nombre Completo:</label>
                        <input type="text" id="secureFullName" placeholder="Juan P√©rez">
                    </div>
                    <div class="form-group">
                        <label>Monto Solicitado:</label>
                        <input type="number" id="secureAmount" placeholder="5000">
                    </div>
                    <div class="form-group">
                        <label>Ingresos Mensuales:</label>
                        <input type="number" id="secureIncome" placeholder="3000">
                    </div>
                    <div class="form-group">
                        <label>Documento de Identidad:</label>
                        <input type="file" id="idDocument" accept=".pdf,.jpg,.png">
                    </div>
                    <div class="form-group">
                        <label>Comprobante de Ingresos:</label>
                        <input type="file" id="incomeProof" accept=".pdf,.jpg,.png">
                    </div>
                    <button onclick="submitSecureForm()">Solicitar Pr√©stamo</button>
                </div>
            </div>
            
            <div class="vulnerability-list">
                <h4>üõ°Ô∏è Controles de Seguridad Implementados:</h4>
                <div class="mitigation-item">
                    <strong>1. Autenticaci√≥n Multifactor:</strong>
                    <p>Verificaci√≥n por SMS/email en lugar de preguntas de seguridad.</p>
                </div>
                <div class="mitigation-item">
                    <strong>2. Validaci√≥n en M√∫ltiples Capas:</strong>
                    <p>Validaci√≥n en frontend, backend y base de datos.</p>
                </div>
                <div class="mitigation-item">
                    <strong>3. Verificaci√≥n de Identidad Real:</strong>
                    <p>Carga de documentos oficiales con verificaci√≥n autom√°tica.</p>
                </div>
                <div class="mitigation-item">
                    <strong>4. Controles de Frecuencia:</strong>
                    <p>L√≠mites por usuario, IP y patrones de comportamiento.</p>
                </div>
                <div class="mitigation-item">
                    <strong>5. L√≥gica de Negocio Robusta:</strong>
                    <p>M√∫ltiples verificaciones cruzadas y auditor√≠a completa.</p>
                </div>
            </div>
        </div>
        
        <div id="analysis" class="tab-content">
            <h3>üîç An√°lisis de Amenazas (Threat Modeling)</h3>
            
            <div class="threat-analysis">
                <h4>üéØ Metodolog√≠a: STRIDE</h4>
                <div class="comparison">
                    <div>
                        <h5>Spoofing (Suplantaci√≥n)</h5>
                        <ul>
                            <li>Identidad falsa del solicitante</li>
                            <li>Reutilizaci√≥n de documentos</li>
                            <li>Cuentas sint√©ticas</li>
                        </ul>
                    </div>
                    <div>
                        <h5>Tampering (Manipulaci√≥n)</h5>
                        <ul>
                            <li>Modificaci√≥n de par√°metros</li>
                            <li>Alteraci√≥n de montos</li>
                            <li>Bypass de validaciones</li>
                        </ul>
                    </div>
                    <div>
                        <h5>Repudiation (Repudio)</h5>
                        <ul>
                            <li>Negaci√≥n de solicitudes</li>
                            <li>Falta de auditor√≠a</li>
                            <li>Logs insuficientes</li>
                        </ul>
                    </div>
                    <div>
                        <h5>Information Disclosure</h5>
                        <ul>
                            <li>Exposici√≥n de datos PII</li>
                            <li>Mensajes de error detallados</li>
                            <li>Informaci√≥n crediticia</li>
                        </ul>
                    </div>
                    <div>
                        <h5>Denial of Service</h5>
                        <ul>
                            <li>Flood de solicitudes</li>
                            <li>Agotamiento de recursos</li>
                            <li>Bloqueo de procesos</li>
                        </ul>
                    </div>
                    <div>
                        <h5>Elevation of Privilege</h5>
                        <ul>
                            <li>Acceso a funciones admin</li>
                            <li>Bypass de controles</li>
                            <li>Escalaci√≥n de permisos</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="vulnerability-list">
                <h4>üö® Casos de Ataque Identificados:</h4>
                <div class="vulnerability-item">
                    <strong>Ataque 1: Fraude de Identidad</strong>
                    <p>Un atacante usa informaci√≥n p√∫blica (redes sociales) para responder preguntas de seguridad y solicitar pr√©stamos con identidad falsa.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>Ataque 2: Manipulaci√≥n de Par√°metros</strong>
                    <p>Modificaci√≥n de JavaScript para cambiar l√≠mites de monto y obtener pr√©stamos superiores al permitido.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>Ataque 3: Flood de Solicitudes</strong>
                    <p>Env√≠o masivo de solicitudes para agotar recursos y potencialmente obtener aprobaciones err√≥neas.</p>
                </div>
                <div class="vulnerability-item">
                    <strong>Ataque 4: Ingenier√≠a Social</strong>
                    <p>Uso de informaci√≥n expuesta en mensajes de error para obtener datos de otros usuarios.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h3>üìä Simulador de Ataques</h3>
        <div class="form-section">
            <h4>Prueba los Controles de Seguridad</h4>
            <div class="form-group">
                <label>Tipo de Ataque:</label>
                <select id="attackType">
                    <option value="parameter">Manipulaci√≥n de Par√°metros</option>
                    <option value="flood">Flood de Solicitudes</option>
                    <option value="identity">Suplantaci√≥n de Identidad</option>
                    <option value="privilege">Escalaci√≥n de Privilegios</option>
                </select>
            </div>
            <div class="form-group">
                <label>Payload del Ataque:</label>
                <textarea id="attackPayload" rows="4" placeholder="Ingresa el payload del ataque..."></textarea>
            </div>
            <button onclick="simulateAttack()" class="danger-btn">Simular Ataque</button>
            <button onclick="showMitigation()">Ver Mitigaci√≥n</button>
        </div>
        <div id="attackResult" class="alert" style="display: none;"></div>
    </div>

    <div class="container">
        <h3>üéì Ejercicios de Aprendizaje</h3>
        
        <div class="form-section">
            <h4>Ejercicio 1: Identificaci√≥n de Vulnerabilidades</h4>
            <p>Examina el siguiente c√≥digo y marca las vulnerabilidades que encuentres:</p>
            
            <div class="code-block">
// Funci√≥n de login vulnerable
function login(username, password) {
    if (username === "admin" && password === "123456") {
        localStorage.setItem("role", "admin");
        return true;
    } else if (users[username] && users[username].password === password) {
        localStorage.setItem("role", "user");
        return true;
    }
    return false;
}

// Funci√≥n de transferencia vulnerable  
function transfer(fromAccount, toAccount, amount) {
    if (localStorage.getItem("role") === "user") {
        if (accounts[fromAccount].balance >= amount) {
            accounts[fromAccount].balance -= amount;
            accounts[toAccount].balance += amount;
            return "Transfer successful";
        }
    }
    return "Transfer failed";
}
            </div>
            
            <div class="form-group">
                <input type="checkbox" id="vuln1"> <label for="vuln1">Credenciales hardcodeadas</label><br>
                <input type="checkbox" id="vuln2"> <label for="vuln2">Almacenamiento inseguro en localStorage</label><br>
                <input type="checkbox" id="vuln3"> <label for="vuln3">Falta de validaci√≥n de entrada</label><br>
                <input type="checkbox" id="vuln4"> <label for="vuln4">Control de acceso basado en cliente</label><br>
                <input type="checkbox" id="vuln5"> <label for="vuln5">Ausencia de logging/auditor√≠a</label><br>
            </div>
            <button onclick="checkVulnerabilities()">Verificar Respuestas</button>
            <div id="vulnResult" style="margin-top: 10px;"></div>
        </div>
        
        <div class="threat-analysis">
            <h4>üí° Puntos Clave para Recordar</h4>
            <ul>
                <li><strong>Dise√±o vs Implementaci√≥n:</strong> Un dise√±o inseguro no se puede "arreglar" con c√≥digo perfecto</li>
                <li><strong>Threat Modeling:</strong> Identificar amenazas desde la fase de dise√±o</li>
                <li><strong>Defensa en Profundidad:</strong> M√∫ltiples capas de controles de seguridad</li>
                <li><strong>Principio de Menor Privilegio:</strong> Dar solo los permisos m√≠nimos necesarios</li>
                <li><strong>Validaci√≥n Multicapa:</strong> Nunca confiar solo en validaciones del frontend</li>
                <li><strong>Secure by Design:</strong> La seguridad debe ser intr√≠nseca, no un agregado</li>
            </ul>
        </div>
    </div>

    <script>
        // Funciones principales de navegaci√≥n
        function showTab(tabName) {
            // Ocultar todos los contenidos de tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Desactivar todos los botones de tabs
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Activar el tab seleccionado
            document.getElementById(tabName).classList.add('active');
            
            // Activar el bot√≥n correspondiente
            const clickedButton = Array.from(tabButtons).find(btn => 
                btn.textContent.includes(getTabDisplayName(tabName))
            );
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }
        
        function getTabDisplayName(tabName) {
            const names = {
                'scenario': 'Escenario',
                'vulnerable': 'Dise√±o Vulnerable',
                'secure': 'Dise√±o Seguro',
                'analysis': 'An√°lisis de Amenazas'
            };
            return names[tabName];
        }
        
        // Funciones de formularios
        function submitVulnerableForm() {
            const amount = document.getElementById('amount').value;
            const income = document.getElementById('income').value;
            const petName = document.getElementById('petName').value;
            
            if (!amount || !income) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            // ‚ùå Validaci√≥n solo en frontend - f√°cil de bypasear
            if (amount > 50000) {
                alert('Monto m√°ximo permitido: $50,000');
                return;
            }
            
            // ‚ùå L√≥gica de aprobaci√≥n insegura
            if (amount <= 5000 && income >= 2000) {
                alert('‚úÖ ¬°Pr√©stamo PRE-APROBADO! Recibir√°s los fondos en 24 horas.');
                console.log('Datos enviados:', { amount, income, petName, autoApproved: true });
            } else {
                alert('üìã Tu solicitud requiere revisi√≥n manual. Te contactaremos pronto.');
            }
            
            // Mostrar vulnerabilidades detectadas
            setTimeout(() => {
                showVulnerabilityAlert();
            }, 2000);
        }
        
        function submitSecureForm() {
            const amount = document.getElementById('secureAmount').value;
            const income = document.getElementById('secureIncome').value;
            const idDoc = document.getElementById('idDocument').files[0];
            const incomeProof = document.getElementById('incomeProof').files[0];
            
            if (!amount || !income) {
                alert('Por favor completa todos los campos requeridos');
                return;
            }
            
            if (!idDoc || !incomeProof) {
                alert('Debes cargar los documentos requeridos');
                return;
            }
            
            alert('üîê Procesando solicitud de forma segura...');
            
            setTimeout(() => {
                alert('üìß Hemos enviado un c√≥digo de verificaci√≥n a tu email/SMS.\n\n' +
                      'üîç Tu solicitud ser√° evaluada con m√∫ltiples verificaciones:\n' +
                      '‚Ä¢ Verificaci√≥n de identidad biom√©trica\n' +
                      '‚Ä¢ An√°lisis de documentos con IA\n' +
                      '‚Ä¢ Verificaci√≥n de ingresos con terceros\n' +
                      '‚Ä¢ Evaluaci√≥n crediticia completa\n\n' +
                      '‚è±Ô∏è Recibir√°s una respuesta en 2-4 horas h√°biles.');
            }, 1500);
        }
        
        function showVulnerabilityAlert() {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger';
            alertDiv.innerHTML = `
                <h4>üö® VULNERABILIDADES DETECTADAS EN EL FORMULARIO:</h4>
                <ul>
                    <li><strong>Preguntas de seguridad inseguras:</strong> La pregunta sobre mascotas es f√°cilmente descifrable</li>
                    <li><strong>Validaci√≥n solo en cliente:</strong> Los l√≠mites pueden ser manipulados</li>
                    <li><strong>Aprobaci√≥n autom√°tica riesgosa:</strong> Sin verificaci√≥n real de identidad</li>
                    <li><strong>Falta de rate limiting:</strong> Posible para enviar m√∫ltiples solicitudes</li>
                </ul>
                <p><em>En un sistema real, estas vulnerabilidades podr√≠an resultar en p√©rdidas millonarias.</em></p>
            `;
            
            const vulnerableSection = document.querySelector('.vulnerable-section');
            vulnerableSection.appendChild(alertDiv);
        }
        
        // Funciones del simulador de ataques
        function simulateAttack() {
            const attackType = document.getElementById('attackType').value;
            const payload = document.getElementById('attackPayload').value;
            const resultDiv = document.getElementById('attackResult');
            
            let result = '';
            let alertClass = 'alert-danger';
            
            switch(attackType) {
                case 'parameter':
                    result = `
                        <h4>üéØ Ataque de Manipulaci√≥n de Par√°metros</h4>
                        <p><strong>Payload:</strong> ${payload || 'amount=999999&bypass=true'}</p>
                        <p><strong>Resultado:</strong> ‚ùå ATAQUE EXITOSO - L√≠mites de monto bypasseados</p>
                        <p><strong>Impacto:</strong> El atacante podr√≠a solicitar pr√©stamos por montos superiores al l√≠mite establecido.</p>
                        <p><strong>Datos comprometidos:</strong> Sistema financiero, l√≠mites de cr√©dito</p>
                    `;
                    break;
                    
                case 'flood':
                    result = `
                        <h4>üåä Ataque de Flood de Solicitudes</h4>
                        <p><strong>Payload:</strong> ${payload || 'for(i=0;i<1000;i++) { submitLoan(); }'}</p>
                        <p><strong>Resultado:</strong> ‚ùå ATAQUE EXITOSO - 1000 solicitudes enviadas en 30 segundos</p>
                        <p><strong>Impacto:</strong> Sobrecarga del sistema, posible aprobaci√≥n de m√∫ltiples pr√©stamos</p>
                        <p><strong>Recursos afectados:</strong> CPU, memoria, base de datos</p>
                    `;
                    break;
                    
                case 'identity':
                    result = `
                        <h4>üë§ Ataque de Suplantaci√≥n de Identidad</h4>
                        <p><strong>Payload:</strong> ${payload || 'petName=Firulais&birthCity=Lima (datos obtenidos de RRSS)'}</p>
                        <p><strong>Resultado:</strong> ‚ùå ATAQUE EXITOSO - Identidad suplantada usando preguntas de seguridad</p>
                        <p><strong>Impacto:</strong> Pr√©stamos fraudulentos a nombre de terceros</p>
                        <p><strong>Informaci√≥n comprometida:</strong> Datos personales, historial crediticio</p>
                    `;
                    break;
                    
                case 'privilege':
                    result = `
                        <h4>üîì Ataque de Escalaci√≥n de Privilegios</h4>
                        <p><strong>Payload:</strong> ${payload || 'role=admin&approve_all=true'}</p>
                        <p><strong>Resultado:</strong> ‚ùå ATAQUE EXITOSO - Acceso a funciones administrativas</p>
                        <p><strong>Impacto:</strong> Aprobaci√≥n masiva de pr√©stamos, acceso a datos sensibles</p>
                        <p><strong>Privilegios obtenidos:</strong> Administrador del sistema</p>
                    `;
                    break;
                    
                default:
                    result = '<p>Selecciona un tipo de ataque v√°lido</p>';
            }
            
            resultDiv.className = `alert ${alertClass}`;
            resultDiv.innerHTML = result;
            resultDiv.style.display = 'block';
        }
        
        function showMitigation() {
            const attackType = document.getElementById('attackType').value;
            const resultDiv = document.getElementById('attackResult');
            
            let mitigation = '';
            
            switch(attackType) {
                case 'parameter':
                    mitigation = `
                        <h4>üõ°Ô∏è Mitigaci√≥n: Validaci√≥n Multicapa</h4>
                        <p><strong>Controles implementados:</strong></p>
                        <ul>
                            <li>‚úÖ Validaci√≥n en API Gateway</li>
                            <li>‚úÖ Validaci√≥n en backend con reglas de negocio</li>
                            <li>‚úÖ Validaci√≥n en base de datos con constraints</li>
                            <li>‚úÖ Tokens CSRF para prevenir manipulaci√≥n</li>
                            <li>‚úÖ Logs de auditor√≠a para detectar intentos de bypass</li>
                        </ul>
                        <p><strong>Resultado:</strong> ‚úÖ ATAQUE BLOQUEADO - Par√°metros validados en todas las capas</p>
                    `;
                    break;
                    
                case 'flood':
                    mitigation = `
                        <h4>üõ°Ô∏è Mitigaci√≥n: Rate Limiting y Throttling</h4>
                        <p><strong>Controles implementados:</strong></p>
                        <ul>
                            <li>‚úÖ Rate limiting: m√°ximo 3 solicitudes por hora por usuario</li>
                            <li>‚úÖ IP throttling: m√°ximo 10 solicitudes por IP por d√≠a</li>
                            <li>‚úÖ CAPTCHA despu√©s de 2 intentos</li>
                            <li>‚úÖ An√°lisis de comportamiento para detectar bots</li>
                            <li>‚úÖ Queue system para manejar picos de carga</li>
                        </ul>
                        <p><strong>Resultado:</strong> ‚úÖ ATAQUE BLOQUEADO - Solicitudes limitadas y monitoreadas</p>
                    `;
                    break;
                    
                case 'identity':
                    mitigation = `
                        <h4>üõ°Ô∏è Mitigaci√≥n: Verificaci√≥n de Identidad Robusta</h4>
                        <p><strong>Controles implementados:</strong></p>
                        <ul>
                            <li>‚úÖ Autenticaci√≥n multifactor (SMS + Email)</li>
                            <li>‚úÖ Verificaci√≥n biom√©trica con selfie + documento</li>
                            <li>‚úÖ Validaci√≥n de documentos con IA</li>
                            <li>‚úÖ Verificaci√≥n cruzada con bases de datos oficiales</li>
                            <li>‚úÖ Eliminaci√≥n de preguntas de seguridad tradicionales</li>
                        </ul>
                        <p><strong>Resultado:</strong> ‚úÖ ATAQUE BLOQUEADO - Identidad verificada con m√∫ltiples factores</p>
                    `;
                    break;
                    
                case 'privilege':
                    mitigation = `
                        <h4>üõ°Ô∏è Mitigaci√≥n: Controles de Acceso Estrictos</h4>
                        <p><strong>Controles implementados:</strong></p>
                        <ul>
                            <li>‚úÖ Principio de menor privilegio</li>
                            <li>‚úÖ Separaci√≥n de funciones (segregation of duties)</li>
                            <li>‚úÖ Autorizaci√≥n basada en roles (RBAC)</li>
                            <li>‚úÖ Tokens JWT con expiraci√≥n corta</li>
                            <li>‚úÖ Monitoreo de actividades privilegiadas</li>
                        </ul>
                        <p><strong>Resultado:</strong> ‚úÖ ATAQUE BLOQUEADO - Acceso denegado, alerta generada</p>
                    `;
                    break;
            }
            
            resultDiv.className = 'alert alert-success';
            resultDiv.innerHTML = mitigation;
            resultDiv.style.display = 'block';
        }
        
        // Funciones del ejercicio de vulnerabilidades
        function checkVulnerabilities() {
            const answers = {
                vuln1: document.getElementById('vuln1').checked,
                vuln2: document.getElementById('vuln2').checked,
                vuln3: document.getElementById('vuln3').checked,
                vuln4: document.getElementById('vuln4').checked,
                vuln5: document.getElementById('vuln5').checked
            };
            
            const correct = {
                vuln1: true,  // Credenciales hardcodeadas
                vuln2: true,  // Almacenamiento inseguro
                vuln3: true,  // Falta de validaci√≥n
                vuln4: true,  // Control basado en cliente
                vuln5: true   // Ausencia de logging
            };
            
            let score = 0;
            let total = Object.keys(correct).length;
            let feedback = '<h4>üìä Resultados:</h4><ul>';
            
            for (let key in correct) {
                if (answers[key] === correct[key]) {
                    score++;
                    feedback += `<li style="color: green;">‚úÖ ${getVulnDescription(key)} - Correcto</li>`;
                } else if (answers[key] && !correct[key]) {
                    feedback += `<li style="color: red;">‚ùå ${getVulnDescription(key)} - Falso positivo</li>`;
                } else {
                    feedback += `<li style="color: red;">‚ùå ${getVulnDescription(key)} - No identificado</li>`;
                }
            }
            
            feedback += '</ul>';
            feedback += `<p><strong>Puntuaci√≥n: ${score}/${total} (${Math.round(score/total*100)}%)</strong></p>`;
            
            if (score === total) {
                feedback += '<p style="color: green;">üéâ ¬°Excelente! Has identificado todas las vulnerabilidades.</p>';
            } else if (score >= total * 0.7) {
                feedback += '<p style="color: orange;">üëç Buen trabajo. Revisa las vulnerabilidades no identificadas.</p>';
            } else {
                feedback += '<p style="color: red;">üìö Necesitas estudiar m√°s sobre dise√±o seguro. Revisa los conceptos.</p>';
            }
            
            document.getElementById('vulnResult').innerHTML = feedback;
        }
        
        function getVulnDescription(key) {
            const descriptions = {
                vuln1: 'Credenciales hardcodeadas (admin/123456)',
                vuln2: 'Almacenamiento inseguro en localStorage',
                vuln3: 'Falta de validaci√≥n de entrada',
                vuln4: 'Control de acceso basado en cliente',
                vuln5: 'Ausencia de logging/auditor√≠a'
            };
            return descriptions[key];
        }
        
        // Inicializaci√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üè¶ Sistema de Pr√©stamos - Ejemplo Did√°ctico Cargado');
            console.log('üìö Este ejemplo demuestra vulnerabilidades de Insecure Design del OWASP Top 10');
            
            // Asegurar que el primer tab est√© activo
            showTab('scenario');
        });
    </script>
</body>
</html>
