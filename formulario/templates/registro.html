{% extends "base.html" %}

{% block title %}Registrar Estudiante - Sistema de Estudiantes{% endblock %}

{% block content %}
<h1>‚ûï Registrar Nuevo Estudiante</h1>

<div class="card">
    <form onsubmit="registrarEstudiante(event)">
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required 
                   placeholder="Ej: Mar√≠a, Carlos, Ana...">
        </div>
        
        <div class="form-group">
            <label for="apellido">Apellido:</label>
            <input type="text" id="apellido" name="apellido" required 
                   placeholder="Ej: Gonz√°lez, Rodr√≠guez, L√≥pez...">
        </div>
        
        <div class="form-group">
            <label for="curso">Curso:</label>
            <select id="curso" name="curso" required>
                <option value="">Selecciona un curso</option>
                <option value="Algoritmos con Python">Algoritmos con Python</option>
                <option value="Detecci√≥n de Superficies Web">Detecci√≥n de Superficies Web</option>
                <option value="Estructuras de Datos">Estructuras de Datos</option>
                <option value="Desarrollo Web">Desarrollo Web</option>
                <option value="Machine Learning">Machine Learning</option>
                <option value="Base de Datos">Base de Datos</option>
                <option value="Programaci√≥n Orientada a Objetos">Programaci√≥n Orientada a Objetos</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="nivel">Nivel:</label>
            <select id="nivel" name="nivel" required>
                <option value="">Selecciona un nivel</option>
                <option value="L1">L1 - B√°sico</option>
                <option value="L2">L2 - Intermedio Bajo</option>
                <option value="L3">L3 - Intermedio</option>
                <option value="L4">L4 - Intermedio Alto</option>
                <option value="L5">L5 - Avanzado</option>
            </select>
        </div>
        
        <button type="submit" class="btn">‚úÖ Registrar Estudiante</button>
        <button type="reset" class="btn" style="background: #6c757d; margin-left: 10px;">üîÑ Limpiar Formulario</button>
    </form>
</div>

<div class="card">
    <h3>üí° Informaci√≥n sobre los Niveles</h3>
    <ul>
        <li><strong>L1 - B√°sico:</strong> Conceptos fundamentales de programaci√≥n</li>
        <li><strong>L2 - Intermedio Bajo:</strong> Estructuras de control y funciones</li>
        <li><strong>L3 - Intermedio:</strong> Programaci√≥n orientada a objetos</li>
        <li><strong>L4 - Intermedio Alto:</strong> Algoritmos avanzados y estructuras de datos</li>
        <li><strong>L5 - Avanzado:</strong> Proyectos complejos y especializaci√≥n</li>
    </ul>
</div>

<script>
async function registrarEstudiante(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const data = {
        nombre: formData.get('nombre').trim(),
        apellido: formData.get('apellido').trim(),
        curso: formData.get('curso'),
        nivel: formData.get('nivel')
    };
    
    // Validaciones adicionales
    if (!data.nombre || !data.apellido) {
        showAlert('‚ùå Por favor completa el nombre y apellido', 'error');
        return;
    }
    
    if (data.nombre.length < 2 || data.apellido.length < 2) {
        showAlert('‚ùå El nombre y apellido deben tener al menos 2 caracteres', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/registrar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showAlert('‚úÖ Estudiante registrado exitosamente!', 'success');
            event.target.reset();
            
            // Mostrar informaci√≥n del estudiante registrado
            setTimeout(() => {
                showAlert(`üìù Estudiante registrado: ${result.estudiante.nombre} ${result.estudiante.apellido} (ID: ${result.estudiante.id})`, 'success');
            }, 1000);
        } else {
            showAlert('‚ùå ' + result.message, 'error');
        }
    } catch (error) {
        showAlert('‚ùå Error al registrar estudiante. Verifica tu conexi√≥n.', 'error');
        console.error('Error:', error);
    }
}
</script>
{% endblock %}